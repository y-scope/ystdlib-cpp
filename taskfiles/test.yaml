version: "3"

vars:
  YSTDLIBS:
    - "testlib"

tasks:
  test-all:
    desc: "Runs all unit tests."
    deps:
      - "build:unit-test-all"
    cmds:
      - "{{.G_TEST_BIN_DIR}}/unit-test-all"

  test-*:
    desc: "Runs unit tests for the specified library."
    vars:
      LIBRARY: >-
        {{index .MATCH 0}}
      TEST_TARGET: >-
        {{printf "unit-test-%s" .LIBRARY}}
    preconditions:
      - sh: >-
          {{ has .LIBRARY .YSTDLIBS }}
        msg: |-
          {{.LIBRARY}} is not a valid ystdlib-cpp library!
          List of libraries:
          {{- range .YSTDLIBS }}
          {{.}}
          {{- end}}
    cmds:
      - task: "build:{{.TEST_TARGET}}"
      - "{{.G_TEST_BIN_DIR}}/{{.TEST_TARGET}}"
