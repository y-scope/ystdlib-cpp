version: "3"

includes:
  ystdlib:
    internal: true
    taskfile: "ystdlib.yaml"

tasks:
  run-debug:
    # The name ystdlib_LIBRARIES should match its CMakeLists.txt equivalent for consistency.
    desc: >-
      debug [ystdlib_LIBRARIES="<lib0;...;libn>"]: Run unit tests for debug libraries. If
      ystdlib_LIBRARIES is defined, only configure and build the listed libraries and their internal
      dependencies.
    cmds:
      - task: "run-unit-test"
        vars:
          BUILD_TYPE: "debug"

  run-release:
    # The name ystdlib_LIBRARIES should match its CMakeLists.txt equivalent for consistency.
    desc: >-
      release [ystdlib_LIBRARIES="<lib0;...;libn>"]: Run unit tests for release libraries. If
      ystdlib_LIBRARIES is defined, only configure and build the listed libraries and their internal
      dependencies.
    cmds:
      - task: "run-unit-test"
        vars:
          BUILD_TYPE: "release"

  run-unit-test:
    internal: true
    requires:
      vars: ["BUILD_TYPE"]
    deps:
      - "ystdlib:build-{{.BUILD_TYPE}}"
    cmd: "{{.G_YSTDLIB_BUILD_DIR}}/{{.BUILD_TYPE}}/testbin/unit-test-all"
